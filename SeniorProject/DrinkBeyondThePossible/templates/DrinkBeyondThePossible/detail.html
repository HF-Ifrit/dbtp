{% extends "DrinkBeyondThePossible/home.html" %}
{% load static %}

<head>

	{% block title %}<title>Drink Info</title>{% endblock title %}
	{% block content %}
	    <style type="text/css">
			h3 {
				color: gray;
				padding-left: 1%;
				font-size: 24px;
			}

			.rating {
				display: inline-block;
			}
			
			body {
				background-color: rgb(0, 0, 0);
				color: rgb(44, 44, 44);

				min-width: 450px;
				line-height: 1.25;
				font-size: 90%;
				margin: 1.5rem;
			}

			#rating {
				padding-top: 5px;
			}

			.Recommendation {
				padding-left: 0.5%;
			}

			.Description {
				padding-left: 1%;
				font-size: 24px;
			}

			.Description p {
				font-size: 16px;
			}

			.Instructions {
				max-width: 350px;
				counter-reset: instructions-counter;
				list-style: none;
				padding-left: 50px;
			}
			.Instructions li {
				margin: 0 0 0.5rem 0;
				counter-increment: instructions-counter;
				position: relative;
				padding-top: 5px;
				font-size: 20px;

			}
			.Instructions li::before {
				content: counter(instructions-counter);
				font-size: 24px;
				position: absolute;
				--size: 26px;
				left: calc(-1 * var(--size) - 15px);
				line-height: var(--size);
				width: var(--size);
				height: var(--size);
				color: #D3D3D3;
				top: 0;
				text-align: center;
				box-shadow: 3px 2px 0 #999;
				background: black;
				border-radius: 8%;
			}

			.container {
			    display: block;
			    position: relative;
			    padding-left: 1%;
			    margin-bottom: 2px;
			    cursor: pointer;
			    font-size: 20px;
			}

			.addtocart {
				margin: 1%;
			}

			.rating {
				border: none;
			}

			

		</style>

</head>

{% block jquery %}
	<script>
		$(document).ready(function()
		{
			//Collect all of the selected ingredients to be added and update current user's ingredient list
			$("#addIngredients").click(function(event)
			{
				selectedIngredients = []
				$("input:checkbox:checked").each(function()
				{
					selectedIngredients.push($(this).attr('value'));
				});

				//Post to server with new ingredients to add if there are any selected
				if(selectedIngredients != [])
				{
					$.post("{% url 'detail' drink.id %}", 
					{'newIngredients[]': selectedIngredients, 
					'csrfmiddlewaretoken': '{{ csrf_token }}'})
					.done(function()
					{
						location.reload();
					});
				}
			});
		});
	</script>
{% endblock jquery %}

<body>
	<!--Drink Info-->
	<h1 class="drinkName">{{ drink.name }}</h1>
	    
    <div class="drinkInfo">
	    <img src="{{ drink.thumbimage }}" align="right">
	    <h3 id="rating">Rating:</h3>


		<h3>Ingredients:</h3>
		{% for ingredient in drink.ingredients %}
		<label class="container">
			{% if ingredient|lower not in user_ingredients %}
			<input type="checkbox" value="{{ ingredient|lower }}"checked="checked">
			{% endif %}
			
			<span class="checkmark"></span>
			{{ ingredient }}
	  	</label>
		{% endfor %}

		<!--Add To Ingredient List-->
		<button type="button" id="addIngredients" class="addtocart">Add to Cart</button>

	  	<!--Note: Instructions come as a string and not individual steps-->
		<h3>Instructions:</h3>
		{{ drink.instructions }}


	    <div class = "Description"> 
		    <h4>Description:</h4>
		    <p>
			Category: {{ drink.category }}<br>
			IBA: {{ drink.iba }}<br>
			Alcoholic?: {{ drink.alcoholic }}<br>
			Glass: {{ drink.glass }}
			</p>
		</div>

	    <!--Recommendation section-->
	    <h5 class="Recommendation">You may also like:</h5>
		<div id="recommendation-table">
			<table>
				<tr>
					{% for drink in recommended_drinks %}
					<td>
						<ul id="recommendation-card">
							<li><img src="{{ drink.strDrinkThumb }}"></li>
							<li><a href="{% url 'detail' drink.idDrink %}">{{ drink.strDrink }}</a></li>
						</ul>
					</td>
					{% endfor %}
				</tr>
			</table>
		</div>

	    <!--Comment section-->
		<h3 class="comments">User Ratings & Comments</h3>
		<p>Total number of comments: {{ comments.count }}</p>

		{% if request.user.is_authenticated %}
		<form method="post">
		{% csrf_token %}
			{{ commentform }} 
			<input type="submit" name = "submit_comment" value="Submit">
		</form>
		{% else %}
		Log in to post comments.
		{% endif %}

		<form method="post">
			<div class="tag_list">
				Tags:
				{% for t in tags %}
					<a href="/tag/{{ t }}"> {{ t }} </a>,
				{% endfor %}
			</div>
		{% csrf_token %}
			{{ tagform }}
			<input type="submit" name = "submit_tag" value="Submit">
		</form>
		
		<hr>
		{% if comments.count > 0 %}
			{% for comment in comments %}
				<div class="user-comment">
					<p>Posted by {{ comment.user }} on: {{ comment.created_time }}</p>
					{% if comment.is_updated %}
						<p>Updated on: {{comment.updated_time}}</p>
					{% endif %}
					{{ comment.message }}
					{% if comment.user == request.user.profile %}
					<form method="post">
						{% csrf_token %}
						{{ editcform }}
						<input type="hidden" name = "c_id" value = "{{ comment.id }}">
						<input type="submit" name = "edit_comment" value="Edit">
					</form>
					{% endif %}
				</div>

			{% endfor %}
		{% else %}
			<p> No comments. </p>
		{% endif %}

			<hr>

	</div>
	{% endblock content %}

</body>